#!/usr/bin/env python3

import serial

def serwrite(ser, b):
    print(b)
    ser.write(b)

with serial.Serial('/dev/ttyS4', 115200) as ser:
    ser.write(b'H')
    x = ser.read()
    print(x)

    senddata = [
            # data
            [0x03, 0x08, 0x1a, 0x23],
            [0x8c, 0x8a, 0x14, 0x5e],
            [0x98, 0xb0, 0x02, 0x1a],

            # state
            [0x1a, 0x99, 0xf3, 0x3d],
            [0x7d, 0xe9, 0x8c, 0x78],
            [0x7f, 0xb2, 0x66, 0xac],
            [0x21, 0x00, 0x72, 0xfa],
            [0x5d, 0xf4, 0x53, 0xab],
            [0x44, 0x96, 0x09, 0xbf],
            [0x63, 0xc0, 0x43, 0xb5],
            [0x61, 0xc2, 0xf2, 0xad],

            # target
            [0x00, 0x00, 0x00, 0x00],
            [0x00, 0x00, 0x00, 0x00],
            [0x00, 0x00, 0x00, 0x00],
            [0x00, 0x00, 0x00, 0x00],
            [0x00, 0x00, 0x00, 0x00],
            [0x00, 0x00, 0x00, 0x00],
            [0xff, 0x9c, 0x00, 0x00],
            [0x00, 0x00, 0x00, 0xff],

            [0x00, 0x00, 0x00, 0x00], # nonce base
            [0x00, 0x00, 0x00, 0x00], # position
            ]

    for b in senddata:
        b.reverse()
        serwrite(ser, b)
    x = ser.read()
    print(x)
    x = ser.read()
    print(x)
    if x == b'Y':
        x = ser.read(4)
        print(x.hex())
